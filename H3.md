# H3 Infraa koodina
## x) Lue ja tiivistä
**Hello Salt Infra as Code (Karvinen 2014)**
* Päivitä paketit ja asenna sen jälkeen salt-minion.
* Asenna tekstieditori micro ja aseta se oletusohjelmaksi.
* Luodaan "hello" niminen hakemisto polkuun `/srv/salt/hello`.
* "hello" kansio pitää sisällään kaiken moduuliin liittyvän, kuten Salt koodin, tiedostot ja mallipohjat.
* `init.sls` tiedosto toimii aloituspisteenä.
* Muokkaa `init.sls` tiedostoa ja määrittele sinne haluamasi toimet, kuten tiedostojen luomisen `file.managed` tilan avulla.
* Aja moduuli "hello" paikallisesti.
* Tuloste kertoo, että `/tmp/hellotero` tiedosto luotiin onnistuneesti.
* Lopuksi voit tarkastaa tiedoston olemassaolon komennolla `ls /tmp/hellotero`.
* Salt toimii idempotentisti, eli se varmistaa, että järjestelmä on halutussa tilassa ilman tarpeettomia muutoksia.
* Jos sama moduuli ajetaan useaan kertaan muutoksia ei tapahdu ja tulosteessa ei näy kohtaa `changed = 1`.

**Salt overview (Salt contributors)**

*Rules of YAML*
* YAML on markup kieli, jota käytetään Salt ohjelmassa.
* YAML seuraa tiettyjä sääntöjä toeteutuksessaan, kuten `avain: arvo` pareja, käytä välilyöntejä älä tabulatuuria ja "#" aloittaa kommentit.
  
*YAML simple structure*
* Avain: arvo pareissa arvo voi olla numero, merkkijono tai boolean-arvo.
* Listoissa avainta seuraa usea arvo ja näistä jokainen arvo on omalla rivillä, sen edessä on kaksi välilyöntiä ja väliviiva.
* Sanakirjat ovat kokoelmia avain: arvo pareista ja listoista.
  
*Lists and dictionaries - YAML block structure*
* YAML käyttää lohkorakennetta, jossa sisennykset määrittävät hierarkian.
* Kokoelmissa, kuten listoissa ja sanakirjoissa jokainen merkintä alkaa väliviivalla ja välilyönnillä.

## a) Hei infrrakoodi!
* Käytin tähän tehtävään H2 tehtävässä luotua virtuaalikonetta, johon oli jo asennettu salt-minion.
* Laitoin virtuaalikoneen päälle `vagrant up` komennolla, jonka jälkeen yhdistyin salt-minion koneeseen komennolla `vagrant ssh t002`.
* Asensin "micro" editorin komennolla `sudo apt-get -y install micro`, jonka jälkeen asetin sen oletusohjelmaksi komennolla `export EDITOR=micro`.
* Loin hakemiston komennolla `sudo mkdir -p /srv/salt/hello/`, jonka jälkeen siirryin kyseiseen hakemistoon komennolla `cd /srv/salt/hello/`.
* Loin ja muokkasin tiedostoa nimeltä init.sls. Käytin komentoa `sudoedit init.sls`.
* Kirjoitin tiedostoon seuraavat tiedot:

![image](https://github.com/user-attachments/assets/8a46d56e-43c3-42b8-bf9b-5e5c1a586b49)
* Tämän jälkeen kokeilin ajaa "hello" moduulin komennolla `sudo salt-call --local state.apply hello`:

![image](https://github.com/user-attachments/assets/55cb1c18-1167-4af7-a0e0-742bf48f76ca)
* Tulosteesta näkee, että "hello" moduuli ajettiin onnistuneesti ja pyytämäni tiedosto luotiin.
* Succeeded: 1 (changed=1)
* Failed: 0
* Varmistin vielä itse, että pyytämäni tiedosto luotiin komennolla `ls /tmp/hellotero`:

![image](https://github.com/user-attachments/assets/6b087514-3209-4a0d-a49c-e2fd4e8f56ff)

## b)
* Käytin tähän tehtävään H2 tehtävässä luotuja virtuaalikoneita t001 (master) ja t002 (minion).
* Yhdistyin t001 koneelle `vagrant ssh t001` komennolla.
* Asensin ja asetin "micron" oletustekstieditoriksi komennoilla `sudo apt-get -y install micro` ja `export EDITOR=micro`.
* Loin haluamani hakemiston komennolla `sudo mkdir -p /srv/salt/hello/` ja siirryin kyseiseen paikkaan komennolla `cd /srv/salt/hello/`.
* Tein ja muokkasin sls tiedoston haluamani mukaan komennolla `sudoedit init.sls`.
* 
* 



